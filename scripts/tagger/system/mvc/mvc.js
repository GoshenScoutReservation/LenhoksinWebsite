"use strict";define(["system/linq","system/componentManager","system/logManager","system/mvc/html"],function(e,n,t,o){function r(){var e={};this.createComponentScope=function(n,t){return i.debug("Creating MVC scope for component {0}",n),t instanceof a?e[n]=t:e[n]=new a(t.controller,t.view)},this.MvcScope=a}function a(n,t){function r(){a={},u=[],e.Enumerable.from(t.querySelectorAll("[model]")).each(function(e){var n=e.getAttribute("model");a[n]||(a[n]=[]);var t=a[n];t.push(new l(e,m))}),e.Enumerable.from(t.querySelectorAll("[event]")).each(function(e){u.push(new c(e,m))})}var a,u,m=this;this.model=n.model||(n.model={}),this.controller=n,this.updateView=function(n){e.Enumerable.from(a[n]).select(function(e){return o.of(e.element)}).where(function(e){return e.value()!=m.model[n]}).each(function(e){i.debug("updating model.{0} on element {1}",n,e.toString()),e.value(m.model[n])})},r()}function l(n,t){function r(){e.Enumerable.From(a(n.tagName)).each(function(e){n.addEventListener(e,l)})}function a(){switch(n.tagName){case"TEXTAREA":case"INPUT":return["change","keyup"];case"SELECT":return["change"];default:return[]}}function l(){var e=o.of(n).value();e!=t.model[c]&&(t.model[c]=e,t.updateView(c),t.controller.modelChanged&&t.controller.modelChanged(c,n,e))}var c=n.getAttribute("model");this.element=n,this.modelKey=c,r()}function c(n,t){function o(){e.Enumerable.from(u||l(n.tagName)).each(function(e){n.addEventListener(e,r)})}function r(){n.disabled||(i.info("Event {0} fired.",c),s.length>0?(n.disabled=!0,s.apply(t,[a])):s.apply(t))}function a(){n.disabled=!1}function l(){switch(n.tagName){case"TEXTAREA":case"INPUT":return["change","keyup"];case"SELECT":return["change"];default:return["click"]}}var c=n.getAttribute("event"),u=null;if(-1!==c.indexOf(":")){var m=c.split(":");c=m[1],u=m[0].split(",")}var s=t.controller[c]||null;this.element=n,s&&o()}var i=t.getLogger("MVC Binder");return new r});
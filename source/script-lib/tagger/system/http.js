"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};define(["system/text","system/logManager","system/linq"],function(t,e,n){function s(e,s,r){function u(){h=!0,o.info("Making {0} request to {1}",e,b);var s=b;null!==d&&(s+="?"+t.toQuery(d)),m.open(e,s),n.Enumerable.from(y).forEach(function(t){return m.setRequestHeader(t.key,y.value)}),m.send(JSON.stringify(p)),m.onprogress=function(t){l&&l(t.loaded/t.total)},m.onreadystatechange=function(){if(m.readyState===(XMLHttpRequest.DONE||4)){T=!0;var t=m.getResponseHeader("Content-Type")||"";switch(t.split(/;\s*/)[0].toLowerCase()){case"application/json":g=JSON.parse(m.responseText);break;default:g=m.responseText}switch(m.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:o.info("Recieved response from {0} with status {1} {2}",b,m.status,m.statusText),"function"==typeof a&&a(g,m.status,m.statusText,m.getAllResponseHeaders());break;default:o.error("Recieved error code {0} {1} from {1}",m.status,m.statusText,b),"function"==typeof f&&f(g,m.status,m.statusText,m.getAllResponseHeaders())}"function"==typeof c&&c(g,m.status,m.statusText,m.getAllResponseHeaders())}}}var i=this,a=void 0,f=void 0,c=void 0,l=void 0,p=null,d=null,y={},h=!1,T=!1,m=new XMLHttpRequest,g=null,E=s.split("?"),b=t.from(E[0],r);E.length>1&&(d=t.fromQuery(E[1])),this.withHeader=function(t,e){return y[t]=e,i},this.query=function(t){d||(d={});for(var e in t)d[e]=t[e];return i},this.basicAuth=function(e,n){return y.Authorization="basic "+btoa(t.from("{0}:{1}",e,n)),i},this.auth=function(e,n){return y.Authorization=t.from("{0} {1}",e,n),i},this.send=function(t){return h?i:t?("object"===("undefined"==typeof t?"undefined":_typeof(t))?(y["Content-Type"]="Application/JSON",p=JSON.stringify(t)):(y["Content-Type"]="Text/Plain",p=t.toString()),u(),i):(u(),i)},this.progress=function(t){return T&&t(1),l=t,i},this.success=function(t){return h||u(),T?(t(g,m.status,m.statusText,m.getAllResponseHeaders()),i):(a=t,i)},this.error=function(t){return h||u(),T?(t(g,m.status,m.statusText,m.getAllResponseHeaders()),i):(f=t,i)},this.done=function(t){return h||u(),T?(t(g,m.status,m.statusText,m.getAllResponseHeaders()),i):(c=t,i)}}var o=e.getLogger("Http Handler"),r={method:{GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},makeRequest:function(t,e,n){return new s(t,e,n)},get:function(t,e){return new s(r.method.GET,t,e)},put:function(t,e){return new s(r.method.PUT,t,e)},post:function(t,e){return new s(r.method.POST,t,e)},"delete":function(t,e){return new s(r.method.DELETE,t,e)}};return r});